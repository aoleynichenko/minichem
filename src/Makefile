# Minichem's top-level makefile
# C++ version

CC=mpicc
CXX=g++
FC=mpif90
CCFLAGS=-Wall
CXXFLAGS=-Wall -std=c++11
SRC=main.c
OBJS=lib/auxlib.o Kernel.o main.o
TARGET=minichem
CLEAN=rm -rf *.o

.PHONY: all clean install uninstall

all: $(TARGET)
clean:
	$(CLEAN)
	rm minichem
	$(MAKE) -C lib clean
install:
	mkdir ../bin ../lib
	cp $(TARGET) ../bin
uninstall:
	rm -r ../bin ../lib

$(TARGET): make-lib Kernel.o main.o
	$(CXX) $(CXXFLAGS) -lm -fopenmp -o $(TARGET) $(OBJS) -llapack -lblas -llapacke
		
main.o: main.cc
	$(CXX) $(CXXFLAGS) -c -o main.o main.cc

Kernel.o: Kernel.cc
	$(CXX) $(CXXFLAGS) -c -o Kernel.o Kernel.cc

make-lib:
	$(MAKE) -C lib auxlib.o CXX=$(CXX)

